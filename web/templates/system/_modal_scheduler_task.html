<!-- 计划任务管理模态框 -->
<div class="modal fade" id="scheduledTaskModal" tabindex="-1" aria-labelledby="scheduledTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: rgba(13, 22, 38, 0.95); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="modal-header" style="background: rgba(13, 22, 38, 0.95); border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <h5 class="modal-title text-light" id="scheduledTaskModalLabel" style="color: #ffffff !important;">
                    <i class="bi bi-clock me-2"></i>计划任务
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="background: rgba(13, 22, 38, 0.95); color: #ffffff;">
                <form id="scheduledTaskForm">
                    <style>
                        #scheduledTaskModal .form-label,
                        #scheduledTaskModal label {
                            color: #ffffff !important;
                        }
                        #scheduledTaskModal .text-muted {
                            color: #adb5bd !important;
                        }
                        #scheduledTaskModal small {
                            color: #adb5bd !important;
                        }
                    </style>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="taskName" class="form-label">任务名称 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control bg-dark text-light" id="taskName" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="backupTargetType" class="form-label">备份目标</label>
                            <select class="form-select bg-dark text-light" id="backupTargetType">
                                <option value="tape" selected>磁带机</option>
                                <option value="storage">存储</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3" id="backupTaskTypeContainer">
                            <label for="backupTaskType" class="form-label">备份类型</label>
                            <select class="form-select bg-dark text-light" id="backupTaskType">
                                <option value="full">完整备份</option>
                                <option value="incremental">增量备份</option>
                                <option value="differential">差异备份</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="scheduleType" class="form-label">调度类型 <span class="text-danger">*</span></label>
                            <select class="form-select bg-dark text-light" id="scheduleType" required>
                                <option value="">请选择</option>
                                <option value="once">一次性任务</option>
                                <option value="interval">间隔任务</option>
                                <option value="daily">每日任务</option>
                                <option value="weekly">每周任务</option>
                                <option value="monthly">每月任务</option>
                                <option value="yearly">每年任务</option>
                                <option value="cron">Cron表达式</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="actionType" class="form-label">任务动作类型 <span class="text-danger">*</span></label>
                            <select class="form-select bg-dark text-light" id="actionType" required>
                                <option value="">请选择</option>
                                <option value="backup">备份任务</option>
                                <option value="recovery">恢复任务</option>
                                <option value="cleanup">清理任务</option>
                                <option value="health_check">健康检查</option>
                                <option value="retention_check">保留期检查</option>
                                <option value="custom">自定义任务</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">调度配置</label>
                            <div id="scheduleConfigContent">
                                <!-- 一次性任务配置 -->
                                <div id="onceConfig" class="schedule-config-panel" style="display: none;">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-dark text-light" id="onceDateTime" placeholder="选择日期和时间" readonly>
                                        <button class="btn btn-outline-secondary" type="button" id="onceDateTimeBtn">
                                            <i class="bi bi-calendar3 me-1"></i>选择
                                        </button>
                                    </div>
                                    <input type="datetime-local" class="form-control d-none" id="onceDateTimeHidden">
                                </div>
                                
                                <!-- 间隔任务配置 -->
                                <div id="intervalConfig" class="schedule-config-panel" style="display: none;">
                                    <div class="row">
                                        <div class="col-8">
                                            <input type="number" class="form-control bg-dark text-light" id="intervalValue" placeholder="间隔值" min="1">
                                        </div>
                                        <div class="col-4">
                                            <select class="form-select bg-dark text-light" id="intervalUnit">
                                                <option value="minutes">分钟</option>
                                                <option value="hours">小时</option>
                                                <option value="days">天</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 每日任务配置 -->
                                <div id="dailyConfig" class="schedule-config-panel" style="display: none;">
                                    <label class="form-label small text-muted">执行时间</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-dark text-light" id="dailyTime" value="02:00" placeholder="HH:MM" pattern="[0-9]{1,2}:[0-9]{2}">
                                        <button class="btn btn-outline-secondary" type="button" id="dailyTimeBtn" title="打开时间选择器">
                                            <i class="bi bi-clock me-1"></i>选择
                                        </button>
                                    </div>
                                    <input type="time" class="form-control d-none" id="dailyTimeHidden" value="02:00">
                                    <small class="text-muted">格式: HH:MM (如 02:00)</small>
                                </div>
                                
                                <!-- 每周任务配置 -->
                                <div id="weeklyConfig" class="schedule-config-panel" style="display: none;">
                                    <div class="row">
                                        <div class="col-6">
                                            <label class="form-label small text-muted">星期</label>
                                            <select class="form-select bg-dark text-light" id="weeklyDay">
                                                <option value="0">周一</option>
                                                <option value="1">周二</option>
                                                <option value="2">周三</option>
                                                <option value="3">周四</option>
                                                <option value="4">周五</option>
                                                <option value="5">周六</option>
                                                <option value="6">周日</option>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small text-muted">执行时间</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control bg-dark text-light" id="weeklyTime" value="02:00" placeholder="HH:MM" pattern="[0-9]{1,2}:[0-9]{2}">
                                                <button class="btn btn-outline-secondary" type="button" id="weeklyTimeBtn" title="打开时间选择器">
                                                    <i class="bi bi-clock"></i>
                                                </button>
                                            </div>
                                            <input type="time" class="form-control d-none" id="weeklyTimeHidden" value="02:00">
                                            <small class="text-muted">格式: HH:MM</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 每月任务配置 -->
                                <div id="monthlyConfig" class="schedule-config-panel" style="display: none;">
                                    <div class="row">
                                        <div class="col-6">
                                            <label class="form-label small text-muted">每月日期</label>
                                            <input type="number" class="form-control bg-dark text-light" id="monthlyDay" placeholder="日期" min="1" max="31" value="1">
                                            <small class="text-muted">1-31</small>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small text-muted">执行时间</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control bg-dark text-light" id="monthlyTime" value="02:00" placeholder="HH:MM" pattern="[0-9]{1,2}:[0-9]{2}">
                                                <button class="btn btn-outline-secondary" type="button" id="monthlyTimeBtn" title="打开时间选择器">
                                                    <i class="bi bi-clock"></i>
                                                </button>
                                            </div>
                                            <input type="time" class="form-control d-none" id="monthlyTimeHidden" value="02:00">
                                            <small class="text-muted">格式: HH:MM (如 02:00)</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 每年任务配置 -->
                                <div id="yearlyConfig" class="schedule-config-panel" style="display: none;">
                                    <div class="row mb-2">
                                        <div class="col-4">
                                            <label class="form-label small text-muted">月份</label>
                                            <input type="number" class="form-control bg-dark text-light" id="yearlyMonth" placeholder="月份" min="1" max="12" value="1">
                                        </div>
                                        <div class="col-4">
                                            <label class="form-label small text-muted">日期</label>
                                            <input type="number" class="form-control bg-dark text-light" id="yearlyDay" placeholder="日期" min="1" max="31" value="1">
                                        </div>
                                        <div class="col-4">
                                            <label class="form-label small text-muted">执行时间</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control bg-dark text-light" id="yearlyTime" value="02:00" placeholder="HH:MM" pattern="[0-9]{1,2}:[0-9]{2}">
                                                <button class="btn btn-outline-secondary" type="button" id="yearlyTimeBtn" title="打开时间选择器">
                                                    <i class="bi bi-clock"></i>
                                                </button>
                                            </div>
                                            <input type="time" class="form-control d-none" id="yearlyTimeHidden" value="02:00">
                                            <small class="text-muted">格式: HH:MM</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Cron表达式配置 -->
                                <div id="cronConfig" class="schedule-config-panel" style="display: none;">
                                    <input type="text" class="form-control bg-dark text-light" id="cronExpression" placeholder="例如: 0 2 * * *">
                                    <small class="text-muted">格式: 分钟 小时 日 月 星期</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 动作配置（根据任务类型动态显示） -->
                    <div class="mb-3" id="actionConfigSection">
                        <label class="form-label">动作配置</label>
                        
                        <!-- 备份任务配置 -->
                        <div id="backupActionConfig" class="action-config-panel" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">备份源路径 <span class="text-danger">*</span></label>
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control bg-dark text-light" id="backupSourcePath" placeholder="输入目录路径，回车添加">
                                    <button class="btn btn-outline-secondary" type="button" id="browseSourcePathBtn" title="浏览并添加目录">
                                        <i class="bi bi-folder-open me-1"></i>浏览
                                    </button>
                                    </div>
                                    <div id="backupSourcePathsList" class="mb-2">
                                        <!-- 已选择的源路径列表 -->
                                    </div>
                                    <small class="text-muted">可添加多个备份源路径，点击"浏览"选择服务器端目录，或手动输入路径（支持网络路径如 \\\\server\\share）</small>
                                </div>
                                <div class="col-md-6 mb-3" id="backupTargetContainer">
                                    <!-- 存储目标：显示目标路径 -->
                                    <div id="backupTargetPathContainer">
                                        <label class="form-label">目标路径 <span class="text-danger">*</span></label>
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control bg-dark text-light" id="backupTargetPath" placeholder="输入目标路径，回车确认">
                                            <button class="btn btn-outline-secondary" type="button" id="browseTargetPathBtn" title="浏览并添加目录">
                                                <i class="bi bi-folder-open me-1"></i>浏览
                                            </button>
                                        </div>
                                        <div id="backupTargetPathsList" class="mb-2">
                                            <!-- 已选择的目标路径列表 -->
                                        </div>
                                        <small class="text-muted">选择存储的目标路径，点击"浏览"选择服务器端目录，或手动输入路径</small>
                                    </div>
                                    
                                    <!-- 磁带机目标：显示磁带机选择 -->
                                    <div id="backupTapeDeviceContainer" style="display: none;">
                                        <label class="form-label">目标磁带机</label>
                                        <div class="input-group mb-2">
                                            <select class="form-select bg-dark text-light" id="backupTapeDeviceSelect">
                                                <option value="">请选择磁带机</option>
                                                <!-- 动态加载磁带机列表 -->
                                            </select>
                                            <button class="btn btn-outline-secondary" type="button" id="addTapeDeviceBtn" title="添加磁带机">
                                                <i class="bi bi-plus-circle me-1"></i>添加
                                            </button>
                                        </div>
                                        <div id="backupTapeDevicesList" class="mb-2">
                                            <!-- 已选择的磁带机列表 -->
                                        </div>
                                        <small class="text-muted">可添加多个目标磁带机，选择后点击"添加"</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="backupCompression" checked>
                                        <label class="form-check-label" for="backupCompression">启用压缩</label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="backupEncryption">
                                        <label class="form-check-label" for="backupEncryption">启用加密</label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="taskEnabled" checked>
                                        <label class="form-check-label" for="taskEnabled">启用任务</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 恢复任务配置 -->
                        <div id="recoveryActionConfig" class="action-config-panel" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">备份集ID</label>
                                <input type="text" class="form-control bg-dark text-light" id="recoveryBackupSetId" placeholder="输入备份集ID">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">恢复目标路径</label>
                                <div class="input-group">
                                    <input type="text" class="form-control bg-dark text-light" id="recoveryTargetPath" placeholder="输入恢复目标路径">
                                    <button class="btn btn-outline-secondary" type="button" id="browseRecoveryPathBtn">
                                        <i class="bi bi-folder-open me-1"></i>浏览
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 清理任务配置 -->
                        <div id="cleanupActionConfig" class="action-config-panel" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">保留天数</label>
                                <input type="number" class="form-control bg-dark text-light" id="cleanupRetentionDays" value="180" min="1">
                                <small class="text-muted">超过此天数的备份将被清理</small>
                            </div>
                        </div>
                        
                        <!-- 健康检查配置 -->
                        <div id="healthCheckActionConfig" class="action-config-panel" style="display: none;">
                            <p class="text-muted">健康检查任务无需额外配置</p>
                        </div>
                        
                        <!-- 保留期检查配置 -->
                        <div id="retentionCheckActionConfig" class="action-config-panel" style="display: none;">
                            <p class="text-muted">保留期检查任务无需额外配置</p>
                        </div>
                        
                        <!-- 自定义任务配置 -->
                        <div id="customActionConfig" class="action-config-panel" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">自定义配置 (JSON格式)</label>
                                <textarea class="form-control font-monospace bg-dark text-light" id="customActionConfigJson" rows="5" placeholder='{"command": "...", "args": [...]}'></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 底部：任务描述和排除模式并排显示 -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="taskDescription" class="form-label">任务描述</label>
                            <textarea class="form-control bg-dark text-light" id="taskDescription" rows="3"></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">排除模式（每行一个）</label>
                            <textarea class="form-control font-monospace bg-dark text-light" id="backupExcludePatterns" rows="3" placeholder="*.tmp&#10;*.log&#10;temp/">*.bak
*.tmp
*.log
*.swp
*.cache
Thumbs.db
.DS_Store
$RECYCLE.BIN
pagefile.sys
$*</textarea>
                        </div>
                    </div>
                    
                </form>
            </div>
            <div class="modal-footer" style="background: rgba(13, 22, 38, 0.95); border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="SchedulerManager.saveTask()">
                    <i class="bi bi-check-circle me-1"></i>保存
                </button>
            </div>
        </div>
    </div>
</div>

