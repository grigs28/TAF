# 根目录文件清理说明

## 清理完成

### ✅ 保留的必要文件

**核心文件**：
- `main.py` - 主程序入口（唯一启动文件）
- `setup.py` - 安装配置
- `requirements.txt` - 依赖包列表
- `README.md` - 项目说明
- `CHANGELOG.md` - 更新日志

**配置文件**：
- `.env.sample` - 配置模板
- `.env` - 实际配置（不应提交到版本控制）
- `.gitignore` - Git忽略规则

### ❌ 已删除的文件

1. **`config_manager.py`** - 重复文件，已移至 `config/config_manager.py`
2. **`main_simple.py`** - 简化版本，统一使用 `main.py`
3. **`start_simple.py`** - 启动脚本
4. **`run.py`** - 启动脚本
5. **`run_system.py`** - 启动脚本
6. **`test_api.py`** - 测试文件应放在 tests 目录
7. **`debug_tape_api.py`** - 调试脚本
8. **`backup_system.db`** - 旧的SQLite数据库文件

## 最终根目录结构

```
d:\app\TAF\
├── main.py              # 主程序入口
├── setup.py             # 安装脚本
├── requirements.txt     # 依赖包
├── README.md            # 项目说明
├── CHANGELOG.md         # 更新日志
├── .env.sample          # 配置模板
├── .env                 # 环境配置（本地）
├── .gitignore           # Git忽略规则
│
├── backup/              # 备份模块
├── recovery/            # 恢复模块
├── tape/                # 磁带驱动
├── config/              # 配置管理
├── models/              # 数据模型
├── web/                 # Web界面
├── mcp/                 # 核心备份
├── utils/               # 工具类
├── tests/               # 测试程序
├── docs/                # 文档
├── logs/                # 日志
└── temp/                # 临时文件
```

## 启动方式

### 标准启动

```bash
conda activate taf
python .\main.py
```

### 开发模式

```bash
python setup.py develop
tape-backup  # 通过入口点启动
```

## 文件说明

### main.py

**唯一主程序入口**，包含：
- 系统初始化
- 组件启动
- Web服务
- 计划任务

**导入**：
- `config.settings` - 系统配置
- `config.database` - 数据库管理
- `web.app` - Web应用
- `utils.*` - 工具类
- `backup.*` - 备份引擎
- `recovery.*` - 恢复引擎
- `tape.*` - 磁带管理

### setup.py

Python包安装配置，支持：
- `pip install .` - 安装到系统
- `pip install -e .` - 开发模式安装

### requirements.txt

所有依赖包列表，包括：
- Web框架（FastAPI, Hypercorn）
- 数据库（SQLAlchemy, asyncpg）
- 压缩（py7zr）
- 异步（aiohttp）
- 加密（cryptography）
- 等等

### .env.sample

配置模板，包含所有可配置参数：
- 应用基础配置
- Web服务配置
- 数据库配置
- 安全配置
- 磁带配置
- 压缩配置
- 计划任务配置
- 钉钉通知配置
- 日志配置
- 监控配置

### .gitignore

Git版本控制忽略规则：
- Python缓存文件
- 虚拟环境
- 数据库文件
- 日志文件
- 临时文件
- IDE配置

## 配置流程

### 1. 首次部署

```bash
# 复制配置模板
cp .env.sample .env  # Linux
copy .env.sample .env  # Windows

# 编辑配置文件
nano .env  # 或使用其他编辑器

# 修改必要配置
# - 数据库连接信息
# - 钉钉API密钥
# - JWT密钥
```

### 2. 安装依赖

```bash
# 激活conda环境
conda activate taf

# 安装依赖
pip install -r requirements.txt

# 或使用setup.py安装
python setup.py install
```

### 3. 启动系统

```bash
python .\main.py
```

### 4. 访问系统

打开浏览器：http://localhost:8080

## 测试

### 运行所有测试

```bash
pytest tests/
```

### 运行特定测试

```bash
pytest tests/test_backup.py
pytest tests/test_tape.py
pytest tests/test_config.py
```

### 生成测试报告

```bash
pytest --cov=. tests/
```

## 文档

所有文档位于 `docs/` 目录：

- **README.md** - 项目总览
- **使用说明.md** - 用户指南
- **开发说明.md** - 开发指南
- **系统架构.md** - 架构说明
- **配置管理说明.md** - 配置说明
- **数据库配置说明.md** - 数据库配置
- **IBM磁带机API使用示例.md** - API示例

## 维护

### 代码规范

- Python代码遵循PEP 8
- 使用Black格式化
- 使用flake8检查
- 中文注释和文档

### 版本管理

- 使用语义化版本
- 重大变更更新CHANGELOG.md
- 发布前测试所有功能

### 部署检查

- [ ] 代码已测试
- [ ] 文档已更新
- [ ] CHANGELOG.md已更新
- [ ] .env.sample已更新
- [ ] 依赖包已更新
- [ ] 所有文件已提交

## 总结

根目录已优化为清晰简洁的结构：
- ✅ 只有一个主程序入口 `main.py`
- ✅ 配置文件规范分离
- ✅ 测试文件在tests目录
- ✅ 文档在docs目录
- ✅ 临时文件已忽略

---

**企业级磁带备份系统**
版本：v1.0.0
更新时间：2024-11-01

